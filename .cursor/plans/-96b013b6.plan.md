<!-- 96b013b6-e232-40ab-8401-81e684995450 458c0fb3-55ca-4057-b4e4-3761ea9f54d7 -->
# WikiArt_VLM統合と本物vsフェイク分類への移行計画

## 現状分析

### 現在の実装状況

- **分類タスク**: 「印象派 vs 非印象派」の様式分類（企画書の目的とは異なる）
- **データセット**: Met APIからのデータ（77件）のみ利用
- **WikiArt_VLMデータセット**: 取得済みだが未統合
  - Original: 39,530枚（本物）
  - Stable-Diffusion: 39,535枚（生成）
  - FLUX: 39,530枚（生成）
  - F-Lite: 39,530枚（生成）

### 企画書の本来の目的

- **分類タスク**: 「本物[0] vs フェイク[1]」の二値分類
- **説明可能性**: SHAPによる「本物らしさの根拠」の可視化
- **教育的価値**: 芸術的真正性、AI倫理の探究

## 実装計画

### Phase 1: WikiArt_VLMデータローダーの実装（優先度：高）

#### 1.1 データローダークラスの作成

- **ファイル**: `src/data_collection/wikiart_vlm_loader.py`
- **機能**:
  - WikiArt_VLMデータセットの画像ペア（Original vs 生成画像）を読み込む
  - 数値ベースのファイル名で対応関係を管理
  - ラベル付け（0: 本物, 1: フェイク）
  - データ拡張・前処理（リサイズ、正規化）
  - train/validation/test分割

#### 1.2 データセット統計の確認

- 各生成モデル（Stable-Diffusion、FLUX、F-Lite）の画像数確認
- 画像の対応関係の完全性チェック
- 画像品質の確認

#### 1.3 Excelプロンプトファイルの読み込み

- `All_gpt4.1-mini_prompt.xlsx`の読み込み機能
- プロンプト情報をメタデータとして保存

### Phase 2: 本物 vs フェイク分類への移行（優先度：高）

#### 2.1 分類タスクの変更

- **変更内容**:
  - 現在: 「印象派 vs 非印象派」（様式分類）
  - 移行後: 「本物 vs フェイク」（真贋分類）
- **実装ファイル**: `src/model_training/random_forest_trainer.py`の修正

#### 2.2 データセット準備

- WikiArt_VLMから訓練データセットを作成
  - 本物画像（Original）をクラス0としてラベル付け
  - 生成画像（Stable-Diffusion/FLUX/F-Lite）をクラス1としてラベル付け
- 生成モデル別のデータセット分割（比較分析のため）

#### 2.3 特徴量抽出の適用

- 既存の色彩特徴量抽出機能をWikiArt_VLMデータに適用
- 画像前処理パイプラインの統合

### Phase 3: モデル訓練と評価（優先度：高）

#### 3.1 ベースラインモデルの訓練

- WikiArt_VLMデータセットでランダムフォレストモデルを訓練
- 生成モデル別（Stable-Diffusion、FLUX、F-Lite）の性能比較
- 交差検証による性能評価

#### 3.2 SHAP説明可能性の適用

- 既存のSHAP説明機能を新しい分類タスクに適用
- 「本物らしさを支える色彩要素」の可視化
- 生成モデルによる差の分析

#### 3.3 性能評価

- 精度、再現率、F1スコアの評価
- 誤分類パターンの分析
- 特徴量重要度の可視化

### Phase 4: LLMを用いたゲシュタルト原則スコアリング（優先度：中）

#### 4.1 MLLM環境の検討

- 利用可能なMLLMの選定（LLaVA、DeepSeek-VL、Gemma 3、MiniGPT-4等）
- ローカル環境での実行可能性の確認
- GPU要件の確認

#### 4.2 プロンプト設計

- ゲシュタルト原則（簡潔性、近接性、類同、連続性、閉合性、図地分離）の評価用プロンプト
- arXiv 2504.12511論文のアプローチを参考
- スコアリング形式の設計（1-5スケールなど）

#### 4.3 スコアリング機能の実装

- **ファイル**: `src/feature_extraction/gestalt_scorer.py`
- MLLMを用いたゲシュタルト原則スコアリング
- バッチ処理による大量画像の処理
- スコアのCSV/JSON形式での保存

#### 4.4 スコアの特徴量化

- LLM生成スコアを数値特徴量として分類モデルに統合
- 既存の色彩特徴量と組み合わせたモデル訓練
- SHAPによるスコアの重要性分析

### Phase 5: 分析と可視化の拡充（優先度：中）

#### 5.1 誤分類作品の分析

- 本物として誤分類された生成画像の分析
- フェイクとして誤分類された本物画像の分析
- 芸術史的・視覚的特徴の分析

#### 5.2 生成モデル間の比較分析

- Stable-Diffusion vs FLUX vs F-Lite の分類性能比較
- 各生成モデルの「本物らしさ」の度合い分析
- 視覚的特徴の違いの可視化

#### 5.3 教育的価値の実現

- 「本物らしさはどこに宿るか？」の可視化
- 誤分類作品の芸術史的検討
- 学生向けの議論テーマの設計

## 技術的な実装詳細

### データローダーの設計

```python
class WikiArtVLMDataLoader:
    def __init__(self, base_path, generation_model='Stable-Diffusion'):
        """
        Args:
            base_path: WikiArt_VLM-mainディレクトリのパス
            generation_model: 使用する生成モデル ('Stable-Diffusion', 'FLUX', 'F-Lite')
        """
    
    def load_image_pairs(self):
        """本物画像と生成画像のペアを読み込む"""
    
    def create_labels(self):
        """ラベル付け（0: 本物, 1: フェイク）"""
    
    def split_dataset(self, train_ratio=0.7, val_ratio=0.15, test_ratio=0.15):
        """train/val/test分割"""
```

### 設定ファイルの更新

`config.yaml`に以下を追加:

- WikiArt_VLMデータセットのパス
- 使用する生成モデルの選択
- データ分割の比率

## 期待される成果

1. **企画書の目的との整合**: 「本物 vs フェイク」分類タスクの実現
2. **大規模データセットの活用**: 39,530枚のデータセットで訓練
3. **説明可能性の向上**: SHAPによる「本物らしさ」の可視化
4. **学術的価値**: 生成AIによる芸術模倣の構造的分析

## 実装の優先順位

1. **最優先**: Phase 1（データローダー）→ Phase 2（分類移行）→ Phase 3（訓練・評価）
2. **次優先**: Phase 4（ゲシュタルト原則スコアリング）
3. **その後**: Phase 5（分析拡充）

## 注意事項

- WikiArt_VLMデータセットは大規模（約40,000枚）のため、メモリ効率を考慮した実装が必要
- 既存の「印象派 vs 非印象派」分類コードは保持し、新機能として追加する
- 生成モデル間の比較分析は、プロジェクトの独自性を高める重要な要素

### To-dos

- [ ] プロジェクト概要セクションを企画書の内容に基づいて更新（タイトル、目的、倫理的・哲学的問いの明記）
- [ ] 分類タスク設計セクションを追加・更新（本物 vs フェイク分類、現在の様式分類との違いを明確化）
- [ ] 特徴量設計セクションを拡充（ゲシュタルト原理、MLLM特徴抽出の追加）
- [ ] WikiArt_VLMデータセットの詳細情報を追加（arXiv論文情報、データセット規模、GitHub公開情報を含む）
- [ ] 教育的価値セクションを新規追加（説明可能AI、芸術哲学、倫理、データ構成倫理）
- [ ] 研究価値と独自性セクションを新規追加
- [ ] 実装計画セクションを更新（スタイルトランスファー、ゲシュタルト特徴量、MLLM統合フェーズの追加）
- [ ] 推奨モデルと機能セクションを新規追加（LLaVA、DeepSeek-VL、Gemma 3、MiniGPT-4等）
- [ ] 今後の課題セクションを拡充（WikiArt_VLM統合、スタイルトランスファー、ゲシュタルト特徴量、MLLM統合、教育的価値の実現）